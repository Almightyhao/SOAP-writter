# 🧠 智慧藥師 SOAP 筆記產生器 (v19.3)

**專案管理・AI 驅動的指引查核・時序分析・自動製圖**

---

## ✅ 核心 AI 分析功能 (v18.2)

AI 會讀取「病患核心資料」欄位，並自動執行以下任務：

| 功能 | 說明 |
| :--- | :--- |
| 📚 **智慧指引查核** | Gemini 會自動分析病歷並使用 Google 搜尋查詢最新臨床指引年份（如 GINA、GOLD、AHA 等）。 |
| 🛡️ **健保規範核對** | AI 會優先核對您貼上的「健保給付規範」，並在 (A) 中評估用藥是否符合規定、有無核刪風險。 |
| 🧾 **強制精準引用** | 必須在 Assessment 明確標示指引名稱＋實際年份，並引用指引原文句子支持建議。 |
| 💊 **DDI 與重複用藥** | 自動解析用藥清單，找出交互作用與重複用藥並提供建議。 |
| 📈 **時序資料分析 (v18.2)** | (極重要) AI 已被指示**必須**分析「病患核心資料」中的 Lab 動態趨勢 (例如 `SCr: 1.2 (10/1) -> 1.5 (10/2)`)。 |
| 🩺 **肝腎功能評估** | AI 指令已更新，強制要求 AI 必須根據病歷中的 CrCl/eGFR 及 Child-Pugh 分數，主動評估藥物劑量調整。 |

## 📊 視覺化製圖功能 (v19.3)

在按下「啟動 AI 分析 & 製圖」時，程式會**獨立讀取「視覺化圖表資料」欄位**，並自動繪製 Lab 數據趨勢圖。

| 功能 | 說明 |
| :--- | :--- |
| 📉 **Lab 趨勢圖 (v19.0)** | 自動解析「視覺化圖表資料」欄位中的時序性 Lab 數據 (SCr, WBC, K+, AST...) 並繪製折線圖。 |
| 🏷️ **彈性格式支援 (v19.3)** | 解析器可辨識多種日期格式 (如 `10/1`, `10-1`, `114/10/1`, `2025/10/1`)，並**自動忽略**單位 (如 `mg/dl`, `K/uL`)。 |

## 🧮 整合式臨床計算機 (v18.0)

一個獨立的「臨床計算機」頁面，供您隨時手動計算。

| 計算機功能 | 說明 |
| :--- | :--- |
| 🧪 **CrCl (C-G) & IBW/ABW** | 輸入 Age, Sex, Weight, Height, SCr 計算 C-G CrCl 與體重評估 (IBW/ABW)。 |
| 🌊 **eGFR (CKD-EPI)** | 自動帶入 C-G 欄位，計算 2021 CKD-EPI eGFR。 |
| 🧍 **BSA (Mosteller)** | 自動帶入 C-G 欄位，計算體表面積 (m²)。 |
| 🫁 **Child-Pugh Score** | 點選 Bilirubin, Albumin, INR, 腹水, 肝腦病變，評估肝功能等級 (A, B, C)。 |
| ❤️ **CHA₂DS₂-VASc Score** | 點選病史（如 CHF, HT, DM...）計算中風風險分數。 |
| 🔄 **智慧型自動計算** | (僅供參考) 在「SOAP 筆記」頁面，系統會自動從「病患核心資料」解析數值，並在右側「自動計算參考區」顯示結果。 |

## 📂 專案管理 (v18.1)

| 功能 | 說明 |
| :--- | :--- |
| 🏠 **主頁 / 專案** | 重構的主頁，可「新增專案」或「載入/刪除」已儲存的專案。 |
| 💾 **儲存專案 (v18.3)** | 在「SOAP 筆記」頁面可「儲存」、「另存新檔」。**會完整保存所有輸入欄位 + AI 輸出結果 + 計算參考值**。 |
| 🔄 **動態版本說明** | 主頁會自動從 GitHub 抓取最新的 README.md 作為版本說明。 |

## 🧩 資料輸入功能

| 欄位 | 說明 |
| :--- | :--- |
| 🏥 **病患核心資料** | **(AI 分析用)** 必填欄位。貼上病史、Lab (含時序趨勢)、用藥、生命徵象等。**AI 會讀取此處所有資料**。 |
| 📊 **視覺化圖表資料 (v19.2)** | **(製圖專用)** 選填欄位。**僅供 JavaScript 繪圖**，AI 不會讀取此處資料。請參見下方的格式說明。 |
| 📜 **健保給付規範** | **(AI 分析用)** 可貼上藥品健保規範文字，AI 會協助判斷是否符合給付條件。 |
| 👨‍⚕️ **專科焦點** | **(AI 分析用)** 選填下拉選單（如心臟內科），讓 AI 評估更精準。 |
| 📚 **專業資料庫整合** | **(AI 分析用)** 可分別貼入 UpToDate / Micromedex / OpenEvidence 重點並整合進評估內容。 |

## 🚀 快速開始

### 1️⃣ 取得 Google Gemini API 金鑰

| 步驟 | 操作 |
| :--- | :--- |
| 1 | 前往 https://aistudio.google.com/ |
| 2 | 左側選單 → **Get API Key** |
| 3 | **Create API key in new project** |
| 4 | 複製金鑰（開頭為 `AIza...`） |

### 2️⃣ 產生 SOAP 筆記

1.  前往 <button>設定</button> 頁面，貼上並**儲存**您的 API 金鑰。 (Grok 金鑰為選用)
2.  前往 <button>主頁 / 專案</button> 頁面，點擊「**➕ 新增 SOAP 筆記專案**」。
3.  在「**病患核心資料**」欄位貼上病歷 (包含用藥、病史、以及您希望 AI 分析的 Lab 趨勢)。
4.  (v19.2 強烈建議) 在「**視覺化圖表資料**」欄位貼上您想繪製的 Lab 趨勢資料。
5.  (選填) 貼上「健保給付規範」以進行核刪風險評估。
6.  (必填) 勾選同意「**使用條款**」。
7.  按下「**🚀 啟動 AI 分析 & 製圖**」。
    ✅ → AI 即時查核指引、健保規範，並整合計算結果與藥物建議。
    ✅ → JavaScript 自動在右側繪製 Lab 趨勢圖。

---

### 📊 「視覺化圖表資料」格式說明 (v19.3)

此欄位僅供**製圖**使用。請**一行只放一個** Lab 項目。

#### 支援的 Lab 關鍵字
`SCr`, `WBC`, `K+`, `Na+`, `Plt`, `AST`, `ALT`, `Hb`, `BUN`, `CRP` (大小寫不拘)

#### 支援的格式 (非常彈性)
爬蟲會自動抓取「數值」和「日期」的配對，並自動忽略中間的單位或文字。

**✅ 推薦格式範例：**
SCr: 1.2 mg/dl (10/1), 1.5 (10/2) -> 0.9 (10/3) WBC: 12.5 K/uL (10/1) 15.0 (10/2) 11.0 (10/3) K+: 3.5 (10-1) 4.0(10-2) 3.8(10-3) AST: 80(114/10/1) 120(114/10/2) 90(114/10/3) BUN: 30(2025/10/1) 45(2025/10/2) CRP: 5.5 10/1, 2.1 10/3

*(備註：必須至少有兩個數據點才能繪製成線圖)*

**(未來將支援用藥史甘特圖，例如：`Vanco: (10/1-10/5)`)**

---

### 🔐 資安與隱私原則

* **本地端處理**： 這是一個純前端 HTML 檔案，所有資料（病歷、API Key、專案）都在您的瀏覽器本地端 (localStorage) 處理，不會上傳到任何非 Google / xAI 的伺服器。
* **使用者責任**： 使用者必須在輸入前，自主完成病患資料的「去識別化」(移除姓名、病歷號等)。
* **法律聲明**： 啟動分析前必須勾選同意「使用條款」，確認已了解去識別化責任。

### ⚕️ 重要聲明
本工具為臨床決策輔助工具。所有輸出內容須由合格醫療專業人員審核後採用。
